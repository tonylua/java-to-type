!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){function e(){e=function(e,t){return new a(e,void 0,t)};var t=RegExp.prototype,n=new WeakMap;function a(e,t,i){var s=new RegExp(e,t);return n.set(s,i||n.get(e)),r(s,a.prototype)}function i(e,t){var r=n.get(t);return Object.keys(r).reduce(function(t,n){var a=r[n];if("number"==typeof a)t[n]=e[a];else{for(var i=0;void 0===e[a[i]]&&i+1<a.length;)i++;t[n]=e[a[i]]}return t},Object.create(null))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&r(e,t)}(a,RegExp),a.prototype.exec=function(e){var n=t.exec.call(this,e);if(n){n.groups=i(n,this);var r=n.indices;r&&(r.groups=i(r,this))}return n},a.prototype[Symbol.replace]=function(e,r){if("string"==typeof r){var a=n.get(this);return t[Symbol.replace].call(this,e,r.replace(/\$<([^>]+)>/g,function(e,t){var n=a[t];return"$"+(Array.isArray(n)?n.join("$"):n)}))}if("function"==typeof r){var s=this;return t[Symbol.replace].call(this,e,function(){var e=arguments;return"object"!=typeof e[e.length-1]&&(e=[].slice.call(e)).push(i(e,s)),r.apply(this,e)})}return t[Symbol.replace].call(this,e,r)},e.apply(this,arguments)}function t(){return t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},t.apply(this,arguments)}function n(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,r(e,t)}function r(e,t){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},r(e,t)}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var i=require("path"),s={boolean:"Boolean",Boolean:"Boolean",char:"String",Character:"String","char[]":"String",String:"String",Date:"String",LocalDate:"String",LocalDateTime:"String",LocalTime:"String",ZonedDateTime:"String",OffsetDateTime:"String",UUID:"String",byte:"Number",Byte:"Number",short:"Number",Short:"Number",int:"Number",Integer:"Number",long:"Number",Long:"Number",float:"Number",Float:"Number",double:"Number",Double:"Number",Instant:"Number",BigDecimal:"Number",BigInteger:"BigInt",Optional:"null",void:"undefined"},o=function e(t,n){void 0===n&&(n=!1);var r=/(?:\w*)List<(\w+)>/g;if(r.test(t))return e(new RegExp(r).exec(t)[1],n)+"[]";var a=s[t]||s[t.toLowerCase()];return a?n?a.toLowerCase():a:t};function u(e,t){var n=null==t?void 0:t.serviceMeta,r=o(e,null==t?void 0:t.outputTS),a=/^(.*?)(\[\])+$/.exec(r);if(a)return u(a[1],n)+a[2];var s=/^(.*?)<(.*?)>$/.exec(r);if(s){var l=s[2].split(/\s*\,\s*/).map(function(e){return u(e,n)}).join(", ");return s[1]+"<"+l+">"}if(r in global.dtsCache){var c=i.dirname(global.dtsCache[r]),p=Object.keys(n).find(function(e){return e===c});p&&(r="import('"+n[p].replace(/\.d\.ts$/,"")+"')."+r)}return r}var l,c,p,m,h=function(e,t){return void 0===t&&(t=""),e.replace(/^"/,t).replace(/"$/,t)},v=function(e){return e.replace(/\n\s*\n/gm,"\n").trim()},f={jsDocServiceRequestInstanceName:"request",jsDocServiceTopImport:"import request from '@/utils/request'"},d=function(e,n,r){return this.javaCode=void 0,this.javaPath=void 0,this.meta=void 0,this.javaCode=e,this.javaPath=n,this.meta=t({},f,r),this},g=(l=/*#__PURE__*/function(e){function t(t,n,r){var i;return(i=e.call(this,t,n,r)||this).controller=void 0,i.services=void 0,i._getController(),i._getServices(),a(i)||a(i)}n(t,e),t.match=function(e){var n=t.SERVICE_RE;return new RegExp(t.CONTROLLER_RE).test(e)&&new RegExp(n).test(e)};var r=t.prototype;return r._getController=function(){var e=new RegExp(t.CONTROLLER_RE).exec(this.javaCode);if(!e)throw new Error("invalid controller");this.controller={url:e[1],name:e[2]}},r._getServices=function(){for(var e,n=[],r=new RegExp(t.SERVICE_RE);null!==(e=r.exec(this.javaCode));){for(var a=e[7],i=[],s=new RegExp(t.PARAM_RE),o=void 0,u=(a||"").replace(/[\n\r]/g,"").replace(/\s+/g," ");null!==(o=s.exec(u));)i.push({param_annotation:o[1],param_type:o[2],param_name:o[3]});var l=/\/\*\*/.test(e[1]);n.push({params:i,desc:l?e[2]:"",method:e[3],url:e[4],res:e[5],name:e[6]})}this.services=n},r._renderServices=function(e){var t,n=this,r=(""+this.controller.url+e.url).replace(/\/+/g,"/"),a=e.params.reduce(function(e,t){var n=t.param_annotation,r="{"+t.param_name+"}";return null!=n&&n.includes("PathVariable")&&e.includes(r)&&(e=e.replace(r,"$"+r)),e},"`"+((null==(t=this.meta)?void 0:t.apiPrefix)||"")+r+"`"),i=r.replace(/\/{\w+?}/g,"").replace(/\/(\w)/g,function(e,t){return t.toUpperCase()}).replace(/^\w/,function(e){return e.toLowerCase()}),s=e.params.map(function(e){var t=e.param_type,r=e.param_name,a=e.param_annotation,i=(null==a?void 0:a.includes("RequestHeader"))?"headers."+r:r,s=a&&a.includes("@NotNull")?" "+i:" ["+i+"]";return("* @param {"+u(t,n.meta)+"} "+s).trim()}).join("\n ").trim(),o=function(e){var t=e.param_name,n=e.param_annotation;return(null==n?void 0:n.includes("RequestHeader"))?null:t},l=e.params.map(o).filter(Boolean).join(", "),c=e.params.filter(function(e){var t=e.param_annotation;return!t||!t.includes("PathVariable")}).map(o).filter(Boolean).map(function(e){return n.javaCode.includes("ResponseBody")?"..."+e:e}),p=e.method.toLowerCase(),m=/(post|put|patch|delete)/.test(p)?"body":"params",h=c.length?m+": {\n      "+c.join(",\n      ")+"\n    }":"";return"/** "+e.desc+" "+i+"\n * @url "+r+"\n * @method "+p.toUpperCase()+"\n "+s+"\n * @return {Promise<"+u(e.res,this.meta)+">}\n */\n\nexport function "+i+" ("+l+") {\n  return "+this.meta.jsDocServiceRequestInstanceName+"({\n    url: "+a+",\n    method: '"+p+"',\n    "+h+"\n  })\n}\n  "},r._getJSDoc=function(){var e=v(this.services.map(this._renderServices.bind(this)).join("\n").trim());return this.meta.jsDocServiceTopImport+"\n\n"+e},r.parse=function(){var e={javaPath:this.javaPath,result:null};if(this.meta.outputTS)throw new Error("ServiceParser with outputTS not support now");return e.result=this._getJSDoc(),e},t}(d),l.CONTROLLER_RE=/*#__PURE__*/e(/@RestController\s*\n\s*@RequestMapping\("([\w\/_-{}:]+?)"\)[\s\S]*?\npublic\s+class\s+(\w+?)Controller\s+/g,{url:1,name:2}),l.SERVICE_RE=/*#__PURE__*/e(/(\/\*{2}\n\s+\*\s+([^@\s]*?)\n(?:[\s\S]+?))?@(?:(Get|Post|Update|Put|Delete)?)Mapping\(\s*(?:value\s*=\s*)?"([\w\/_-{}:]+?)".*?\)(?:[\s\S]+?)public\s+([\w<>_[\](,\s)]+?)\s+([\w_-]+?)\(([\s\S]*)\)?\s*\{/gi,{desc:2,method:3,url:4,res:5,name:6,params_str:7}),l.PARAM_RE=/*#__PURE__*/e(/(@.*?\s)?([\w<>_[\](,\s)]+?)\s+(\w+)(?:,\s*)?/g,{param_annotation:1,param_type:2,param_name:3}),l),E=(c=/*#__PURE__*/function(t){function r(e,n,r){var i;return(i=t.call(this,e,n,r)||this).enumNames=void 0,i.properties=void 0,i._getEnumNames(),i._getProperties(),a(i)||a(i)}n(r,t),r.match=function(e){var t=r.PROPERTY_RE;return new RegExp(r.ENUM_RE).test(e)&&new RegExp(t).test(e)};var i=r.prototype;return i._getEnumNames=function(){if(r.INTERFACE_ENUMS.test(this.javaCode)){for(var t,n=new RegExp(/*#__PURE__*/e(/enum\s+(\w+)/gm,{enum_name:1})),a=[];null!==(t=n.exec(this.javaCode));){var i;a.push(null==(i=t)?void 0:i[1])}this.enumNames=a}else{var s=new RegExp(r.ENUM_RE).exec(this.javaCode);this.enumNames=[null==s?void 0:s[1]]}},i._getProperties=function(){var e=this,t={};this.enumNames.length&&this.enumNames.forEach(function(n,a){var i=e.javaCode.indexOf("enum "+n),s=a<e.enumNames.length-1?e.javaCode.indexOf("enum "+e.enumNames[a+1]):e.javaCode.length,o=e.javaCode.substring(i,s);t[n]=[];for(var u,l=new RegExp(r.PROPERTY_RE);null!==(u=l.exec(o));){var c={key:u[1],value:u[2],desc:u[3]};c.type=/["']+/.test(c.value)?"String":"Number",t[n].push(c)}}),this.properties=t},i._getJSDocWithTS=function(){var e=this;if(!this.enumNames.length)return"";var t=[];return this.enumNames.forEach(function(n){var a=e.properties[n];o(a[0].type,e.meta.outputTS);var i=a.length?a.map(function(e,t){var n=e.desc,r=e.value;return"  "+(e.key+(r?" = "+h(r,"'"):"")+", "+(n?"// "+h(n):"")).trim()}).join("\n").trim():"/*TODO no property*/";t.push(v(i="export enum "+n+" {\n  "+i+"\n}\n")),r.INTERFACE_ENUMS.test(e.javaCode)||(global.dtsCache[n]=e.javaPath)}),t.join("\n\n")},i._getJSDoc=function(){var e=this;if(!this.enumNames.length)return"";var t=[];return this.enumNames.forEach(function(n){var r=e.properties[n],a=o(r[0].type),i=r.length?r.map(function(e,t){var n=e.desc,r=e.value;return"  "+(e.key+(r?": "+h(r,"'"):": "+t)+", "+(n?"// "+h(n):"")).trim()}).join("\n").trim():"* @todo no property";t.push(v(i="/**\n * @readonly\n * @enum {"+a+"}\n */\n"+(i="export const "+n+" = {\n  "+i+"\n}\n")))}),t.join("\n\n")},i.parse=function(){var e={javaPath:this.javaPath,result:null};return e.result=this.meta.outputTS?this._getJSDocWithTS():this._getJSDoc(),e},r}(d),c.INTERFACE_ENUMS=/*#__PURE__*/e(/(?<=public\sinterface)[\s\S]+?enum\s+(\w+)/gm,{enum_name:1}),c.ENUM_RE=/*#__PURE__*/e(/public\s+(?:interface|enum)\s+(\w+)/g,{enum_name:1}),c.PROPERTY_RE=/*#__PURE__*/e(/^\s+([a-zA-Z_]+?)(?:\((\S+?)\s*(?:,\s*(.+?))?\))?[,;]/gm,{key:1,value:2,desc:3}),c),R=(p=/*#__PURE__*/function(e){function t(t,n,r){var i;return(i=e.call(this,t,n,r)||this).className=void 0,i.properties=void 0,i._getClassName(),i._getProperties(),a(i)||a(i)}n(t,e),t.match=function(e){var n=t.PROPERTY_RE;return new RegExp(t.CLASS_RE).test(e)&&new RegExp(n).test(e)},t.matchNestedStaticClasses=function(e){for(var n,r=[];null!==(n=t.NESTED_STATIC_CLASS_RE.exec(e));){var a=n[1];if(a){for(var i=n.index,s=1,o=i+1;o<e.length&&s>0;){var u=e[o];"{"===u?s++:"}"===u&&s--,o++}if(0===s){var l=o-1,c=e.substring(0,i).split("\n").length,p=e.substring(0,l).split("\n").length;r.push({startLine:c,endLine:p,className:a})}}}return null!=r&&r.length?r:null},t.extractSubclass=function(e,t,n){return e.split("\n").slice(t-1,n).join("\n")},t.deleteSubclass=function(e,t,n){var r=e.split("\n");return r.splice(t-1,n-t+1),r.join("\n")};var r=t.prototype;return r._getClassName=function(){var e=new RegExp(t.CLASS_RE).exec(this.javaCode);this.className=e[1]},r._getProperties=function(){for(var e,n=[],r=new RegExp(t.PROPERTY_RE);null!==(e=r.exec(this.javaCode));){var a={desc:e[1],type:e[2],name:e[3],isOptional:!e[0].includes("@NotNull")};n.push(a)}this.properties=n},r._getJSDoc=function(){var e=new RegExp(t.PROPERTY_RE).test(this.javaCode)?this.properties.map(function(e){var t=e.desc,n=e.name,r=e.isOptional?" ["+n+"]":" "+n,a=t?" - "+t:"";return("* @property {"+o(e.type)+"} "+r+a).trim()}).join("\n ").trim():"* @todo no property";return v(e="/**\n * @typedef {Object} "+this.className+"\n "+e+"\n*/")},r._getJSDocWithTS=function(){var e=this,n=new RegExp(t.PROPERTY_RE).test(this.javaCode)?this.properties.map(function(t){var n=t.desc;return(t.name+(t.isOptional?"?":"")+": "+o(t.type,e.meta.outputTS)+";"+(n?" // "+n:"")).trim()}).join("\n ").trim():"/*TODO no property*/";return n="export type "+this.className+" = {\n "+n+"\n}\n",global.dtsCache[this.className]=this.javaPath,v(n)},r.parse=function(){var e={javaPath:this.javaPath,result:null};return e.result=this.meta.outputTS?this._getJSDocWithTS():this._getJSDoc(),e},t}(d),p.CLASS_RE=/*#__PURE__*/e(/public\s+class\s+(\w+)/g,{class_name:1}),p.PROPERTY_RE=/*#__PURE__*/e(/(?:\n(?:[^\n\S]|\t)+\/\*{2}\s*\n\s*\*\s+((?:[^@].+)?)[\s\S]*?)?private\s+([\w<>[\]]+)\s+(\w+);/g,{desc:1,type:2,name:3}),p.NESTED_STATIC_CLASS_RE=/*#__PURE__*/e(/public\s+static\s+class\s+(\w+).*?\{/g,{class_name:1}),p),_=(m=/*#__PURE__*/function(e){function t(t,n,r){var i;return(i=e.call(this,t,n,r)||this).enumName=void 0,i.properties=void 0,i._getEnumName(),i._getProperties(),a(i)||a(i)}n(t,e),t.match=function(e){var n=t.PROPERTY_RE;return new RegExp(t.ENUM_RE).test(e)&&new RegExp(n).test(e)};var r=t.prototype;return r._getEnumName=function(){var e=new RegExp(t.ENUM_RE).exec(this.javaCode);this.enumName=e[1]},r._getProperties=function(){for(var e,n=[],r=new RegExp(t.PROPERTY_RE);null!==(e=r.exec(this.javaCode));)n.push({desc:e[1],type:e[2],key:e[3],value:e[4]});this.properties=n},r._getJSDocWithTS=function(){if(!this.properties.length)return"";o(this.properties[0].type,this.meta.outputTS);var e=new RegExp(t.PROPERTY_RE).test(this.javaCode)?this.properties.map(function(e,t){var n=e.desc,r=e.value;return"  "+(e.key+(r?" = "+h(r,"'"):"")+", "+(n?"// "+h(n):"")).trim()}).join("\n").trim():"/*TODO no property*/";return e="export enum "+this.enumName+" {\n  "+e+"\n}\n",global.dtsCache[this.enumName]=this.javaPath,v(e)},r._getJSDoc=function(){if(!this.properties.length)return"";var e=o(this.properties[0].type),n=new RegExp(t.PROPERTY_RE).test(this.javaCode)?this.properties.map(function(e,t){var n=e.desc,r=e.value;return"  "+(e.key+(r?": "+h(r,"'"):": "+t)+", "+(n?"// "+h(n):"")).trim()}).join("\n").trim():"* @todo no property";return v(n="/**\n * @readonly\n * @enum {"+e+"}\n */\n"+(n="export const "+this.enumName+" = {\n  "+n+"\n}\n"))},r.parse=function(){var e={javaPath:this.javaPath,result:null};return e.result=this.meta.outputTS?this._getJSDocWithTS():this._getJSDoc(),e},t}(d),m.ENUM_RE=/*#__PURE__*/e(/public\s+class\s+(\w+)/g,{enum_name:1}),m.PROPERTY_RE=/(?:\s*\/\*{2}\n\s*\*\s+([^@\s]+?)\n[\s\S]+?)?public\sstatic\sfinal\s([\w<>[\]]+)\s+([\w_]+)\s*=\s*(("|[^\s$])+);?/g,m),S=require("fs"),y=require("fs"),b=require("path");function j(e,t,n){var r=[],a=e,i=[];if(g.match(a))r.push(g);else if(null!=n&&n.isEnum)r.push(E.match(a)?E:_.match(a)?_:null);else if(R.match(a)){var s=null==R||null==R.matchNestedStaticClasses?void 0:R.matchNestedStaticClasses(a);if(null!=s&&s.length)for(var o=s.length-1;o>-1;o--){var u,l=s[o],c=l.startLine,p=l.endLine,m=l.className,h=null==R||null==R.extractSubclass||null==(u=R.extractSubclass(a,c,p))?void 0:u.replace(/static\s+class/,"class"),v=t.replace(/\.java$/,"")+(m+".java");i.push(new R(h,v,null==n?void 0:n.parserMeta).parse()),a=null==R||null==R.deleteSubclass?void 0:R.deleteSubclass(a,c,p)}r.push(R)}return(r=r.filter(Boolean)).length?[].concat(i,r.map(function(e){return new e(a,t,null==n?void 0:n.parserMeta).parse()})):null}global.dtsCache={},module.exports={parseJava:j,parseDir:function(e,t){return y.readdirSync(e).reduce(function(n,r){if(".java"!==b.extname(r))return n;var a=b.join(e,r),i=function(e){try{return S.readFileSync(e,"utf8")}catch(t){return console.error("read error:",e),null}}(a);if(!i)return n;var s=j(i,a,t);return s?[].concat(n,s):n},[]).filter(Boolean)}}});
//# sourceMappingURL=j2type.js.map

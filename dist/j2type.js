!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){function e(){e=function(e,t){return new a(e,void 0,t)};var t=RegExp.prototype,n=new WeakMap;function a(e,t,s){var i=new RegExp(e,t);return n.set(i,s||n.get(e)),r(i,a.prototype)}function s(e,t){var r=n.get(t);return Object.keys(r).reduce(function(t,n){var a=r[n];if("number"==typeof a)t[n]=e[a];else{for(var s=0;void 0===e[a[s]]&&s+1<a.length;)s++;t[n]=e[a[s]]}return t},Object.create(null))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&r(e,t)}(a,RegExp),a.prototype.exec=function(e){var n=t.exec.call(this,e);if(n){n.groups=s(n,this);var r=n.indices;r&&(r.groups=s(r,this))}return n},a.prototype[Symbol.replace]=function(e,r){if("string"==typeof r){var a=n.get(this);return t[Symbol.replace].call(this,e,r.replace(/\$<([^>]+)>/g,function(e,t){var n=a[t];return"$"+(Array.isArray(n)?n.join("$"):n)}))}if("function"==typeof r){var i=this;return t[Symbol.replace].call(this,e,function(){var e=arguments;return"object"!=typeof e[e.length-1]&&(e=[].slice.call(e)).push(s(e,i)),r.apply(this,e)})}return t[Symbol.replace].call(this,e,r)},e.apply(this,arguments)}function t(){return t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},t.apply(this,arguments)}function n(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,r(e,t)}function r(e,t){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},r(e,t)}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var s=require("path"),i={boolean:"Boolean",Date:"String",char:"String","char[]":"String",String:"String",byte:"String",short:"Number",int:"Number",Integer:"Number",long:"Number",float:"Number",double:"Number",BigDecimal:"Number",BigInteger:"BigInt"},o=function e(t,n){void 0===n&&(n=!1);var r=/(?:\w*)List<(\w+)>/g;if(r.test(t))return e(new RegExp(r).exec(t)[1],n)+"[]";var a=i[t]||i[t.toLowerCase()];return a?n?a.toLowerCase():a:t};function u(e,t){var n=null==t?void 0:t.serviceMeta,r=o(e,null==t?void 0:t.outputTS),a=/^(.*?)(\[\])+$/.exec(r);if(a)return u(a[1],n)+a[2];var i=/^(.*?)<(.*?)>$/.exec(r);if(i){var c=i[2].split(/\s*\,\s*/).map(function(e){return u(e,n)}).join(", ");return i[1]+"<"+c+">"}if(r in global.dtsCache){var l=s.dirname(global.dtsCache[r]),p=Object.keys(n).find(function(e){return e===l});p&&(r="import('"+n[p].replace(/\.d\.ts$/,"")+"')."+r)}return r}var c,l,p,h,m=function(e,t){return void 0===t&&(t=""),e.replace(/^"/,t).replace(/"$/,t)},v=function(e){return e.replace(/\n\s*\n/gm,"\n").trim()},f={jsDocServiceRequestInstanceName:"request",jsDocServiceTopImport:"import request from '@/utils/request'"},d=function(e,n,r){return this.javaCode=void 0,this.javaPath=void 0,this.meta=void 0,this.javaCode=e,this.javaPath=n,this.meta=t({},f,r),this},g=(c=/*#__PURE__*/function(e){function t(t,n,r){var s;return(s=e.call(this,t,n,r)||this).controller=void 0,s.services=void 0,s._getController(),s._getServices(),a(s)||a(s)}n(t,e),t.match=function(e){var n=t.SERVICE_RE;return new RegExp(t.CONTROLLER_RE).test(e)&&new RegExp(n).test(e)};var r=t.prototype;return r._getController=function(){var e=new RegExp(t.CONTROLLER_RE).exec(this.javaCode);if(!e)throw new Error("invalid controller");this.controller={url:e[1],name:e[2]}},r._getServices=function(){for(var e,n=[],r=new RegExp(t.SERVICE_RE);null!==(e=r.exec(this.javaCode));){for(var a=e[7],s=[],i=new RegExp(t.PARAM_RE),o=void 0,u=(a||"").replace(/[\n\r]/g,"").replace(/\s+/g," ");null!==(o=i.exec(u));)s.push({param_annotation:o[1],param_type:o[2],param_name:o[3]});var c=/\/\*\*/.test(e[1]);n.push({params:s,desc:c?e[2]:"",method:e[3],url:e[4],res:e[5],name:e[6]})}this.services=n},r._renderServices=function(e){var t,n=this,r=(""+this.controller.url+e.url).replace(/\/+/g,"/"),a=e.params.reduce(function(e,t){var n=t.param_annotation,r="{"+t.param_name+"}";return null!=n&&n.includes("PathVariable")&&e.includes(r)&&(e=e.replace(r,"$"+r)),e},"`"+((null==(t=this.meta)?void 0:t.apiPrefix)||"")+r+"`"),s=r.replace(/\/{\w+?}/g,"").replace(/\/(\w)/g,function(e,t){return t.toUpperCase()}).replace(/^\w/,function(e){return e.toLowerCase()}),i=e.params.map(function(e){var t=e.param_type,r=e.param_name,a=e.param_annotation,s=(null==a?void 0:a.includes("RequestHeader"))?"headers."+r:r,i=a&&a.includes("@NotNull")?" "+s:" ["+s+"]";return("* @param {"+u(t,n.meta)+"} "+i).trim()}).join("\n ").trim(),o=function(e){var t=e.param_name,n=e.param_annotation;return(null==n?void 0:n.includes("RequestHeader"))?null:t},c=e.params.map(o).filter(Boolean).join(", "),l=e.params.filter(function(e){var t=e.param_annotation;return!t||!t.includes("PathVariable")}).map(o).filter(Boolean).map(function(e){return n.javaCode.includes("ResponseBody")?"..."+e:e}),p=e.method.toLowerCase(),h=/(post|put|patch|delete)/.test(p)?"body":"params",m=l.length?h+": {\n      "+l.join(",\n      ")+"\n    }":"";return"/** "+e.desc+" "+s+"\n * @url "+r+"\n * @method "+p.toUpperCase()+"\n "+i+"\n * @return {Promise<"+u(e.res,this.meta)+">}\n */\n\nexport function "+s+" ("+c+") {\n  return "+this.meta.jsDocServiceRequestInstanceName+"({\n    url: "+a+",\n    method: '"+p+"',\n    "+m+"\n  })\n}\n  "},r._getJSDoc=function(){var e=v(this.services.map(this._renderServices.bind(this)).join("\n").trim());return this.meta.jsDocServiceTopImport+"\n\n"+e},r.parse=function(){var e={javaPath:this.javaPath,result:null};if(this.meta.outputTS)throw new Error("ServiceParser with outputTS not support now");return e.result=this._getJSDoc(),e},t}(d),c.CONTROLLER_RE=/*#__PURE__*/e(/@RestController\s*\n\s*@RequestMapping\("([\w\/_-{}:]+?)"\)[\s\S]*?\npublic\s+class\s+(\w+?)Controller\s+/g,{url:1,name:2}),c.SERVICE_RE=/*#__PURE__*/e(/(\/\*{2}\n\s+\*\s+([^@\s]*?)\n(?:[\s\S]+?))?@(?:(Get|Post|Update|Put|Delete)?)Mapping\(\s*(?:value\s*=\s*)?"([\w\/_-{}:]+?)".*?\)(?:[\s\S]+?)public\s+([\w<>_[\](,\s)]+?)\s+([\w_-]+?)\(([\s\S]*)\)?\s*\{/gi,{desc:2,method:3,url:4,res:5,name:6,params_str:7}),c.PARAM_RE=/*#__PURE__*/e(/(@.*?\s)?([\w<>_[\](,\s)]+?)\s+(\w+)(?:,\s*)?/g,{param_annotation:1,param_type:2,param_name:3}),c),E=(l=/*#__PURE__*/function(t){function r(e,n,r){var s;return(s=t.call(this,e,n,r)||this).enumNames=void 0,s.properties=void 0,s._getEnumNames(),s._getProperties(),a(s)||a(s)}n(r,t),r.match=function(e){var t=r.PROPERTY_RE;return new RegExp(r.ENUM_RE).test(e)&&new RegExp(t).test(e)};var s=r.prototype;return s._getEnumNames=function(){if(r.INTERFACE_ENUMS.test(this.javaCode)){for(var t,n=new RegExp(/*#__PURE__*/e(/enum\s+(\w+)/gm,{enum_name:1})),a=[];null!==(t=n.exec(this.javaCode));){var s;a.push(null==(s=t)?void 0:s[1])}this.enumNames=a}else{var i=new RegExp(r.ENUM_RE).exec(this.javaCode);this.enumNames=[null==i?void 0:i[1]]}},s._getProperties=function(){var e=this,t={};this.enumNames.length&&this.enumNames.forEach(function(n,a){var s=e.javaCode.indexOf("enum "+n),i=a<e.enumNames.length-1?e.javaCode.indexOf("enum "+e.enumNames[a+1]):e.javaCode.length,o=e.javaCode.substring(s,i);t[n]=[];for(var u,c=new RegExp(r.PROPERTY_RE);null!==(u=c.exec(o));){var l={key:u[1],value:u[2],desc:u[3]};l.type=/["']+/.test(l.value)?"String":"Number",t[n].push(l)}}),this.properties=t},s._getJSDocWithTS=function(){var e=this;if(!this.enumNames.length)return"";var t=[];return this.enumNames.forEach(function(n){var a=e.properties[n];o(a[0].type,e.meta.outputTS);var s=a.length?a.map(function(e,t){var n=e.desc,r=e.value;return"  "+(e.key+(r?" = "+m(r,"'"):"")+", "+(n?"// "+m(n):"")).trim()}).join("\n").trim():"/*TODO no property*/";t.push(v(s="export enum "+n+" {\n  "+s+"\n}\n")),r.INTERFACE_ENUMS.test(e.javaCode)||(global.dtsCache[n]=e.javaPath)}),t.join("\n\n")},s._getJSDoc=function(){var e=this;if(!this.enumNames.length)return"";var t=[];return this.enumNames.forEach(function(n){var r=e.properties[n],a=o(r[0].type),s=r.length?r.map(function(e,t){var n=e.desc,r=e.value;return"  "+(e.key+(r?": "+m(r,"'"):": "+t)+", "+(n?"// "+m(n):"")).trim()}).join("\n").trim():"* @todo no property";t.push(v(s="/**\n * @readonly\n * @enum {"+a+"}\n */\n"+(s="export const "+n+" = {\n  "+s+"\n}\n")))}),t.join("\n\n")},s.parse=function(){var e={javaPath:this.javaPath,result:null};return e.result=this.meta.outputTS?this._getJSDocWithTS():this._getJSDoc(),e},r}(d),l.INTERFACE_ENUMS=/*#__PURE__*/e(/(?<=public\sinterface)[\s\S]+?enum\s+(\w+)/gm,{enum_name:1}),l.ENUM_RE=/*#__PURE__*/e(/public\s+(?:interface|enum)\s+(\w+)/g,{enum_name:1}),l.PROPERTY_RE=/*#__PURE__*/e(/^\s+([a-zA-Z_]+?)(?:\((\S+?)\s*(?:,\s*(.+?))?\))?[,;]/gm,{key:1,value:2,desc:3}),l),R=(p=/*#__PURE__*/function(e){function t(t,n,r){var s;return(s=e.call(this,t,n,r)||this).className=void 0,s.properties=void 0,s._getClassName(),s._getProperties(),a(s)||a(s)}n(t,e),t.match=function(e){var n=t.PROPERTY_RE;return new RegExp(t.CLASS_RE).test(e)&&new RegExp(n).test(e)},t.matchNestedStaticClasses=function(e){for(var n,r=[];null!==(n=t.NESTED_STATIC_CLASS_RE.exec(e));){var a=n[1];if(a){for(var s=n.index,i=1,o=s+1;o<e.length&&i>0;){var u=e[o];"{"===u?i++:"}"===u&&i--,o++}if(0===i){var c=o-1,l=e.substring(0,s).split("\n").length,p=e.substring(0,c).split("\n").length;r.push({startLine:l,endLine:p,className:a})}}}return null!=r&&r.length?r:null},t.extractSubclass=function(e,t,n){return e.split("\n").slice(t-1,n).join("\n")},t.deleteSubclass=function(e,t,n){var r=e.split("\n");return r.splice(t-1,n-t+1),r.join("\n")};var r=t.prototype;return r._getClassName=function(){var e=new RegExp(t.CLASS_RE).exec(this.javaCode);this.className=e[1]},r._getProperties=function(){for(var e,n=[],r=new RegExp(t.PROPERTY_RE);null!==(e=r.exec(this.javaCode));){var a={desc:e[1],type:e[2],name:e[3],isOptional:!e[0].includes("@NotNull")};n.push(a)}this.properties=n},r._getJSDoc=function(){var e=new RegExp(t.PROPERTY_RE).test(this.javaCode)?this.properties.map(function(e){var t=e.desc,n=e.name,r=e.isOptional?" ["+n+"]":" "+n,a=t?" - "+t:"";return("* @property {"+o(e.type)+"} "+r+a).trim()}).join("\n ").trim():"* @todo no property";return v(e="/**\n * @typedef {Object} "+this.className+"\n "+e+"\n*/")},r._getJSDocWithTS=function(){var e=this,n=new RegExp(t.PROPERTY_RE).test(this.javaCode)?this.properties.map(function(t){var n=t.desc;return(t.name+(t.isOptional?"?":"")+": "+o(t.type,e.meta.outputTS)+";"+(n?" // "+n:"")).trim()}).join("\n ").trim():"/*TODO no property*/";return n="export type "+this.className+" = {\n "+n+"\n}\n",global.dtsCache[this.className]=this.javaPath,v(n)},r.parse=function(){var e={javaPath:this.javaPath,result:null};return e.result=this.meta.outputTS?this._getJSDocWithTS():this._getJSDoc(),e},t}(d),p.CLASS_RE=/*#__PURE__*/e(/public\s+class\s+(\w+)/g,{class_name:1}),p.PROPERTY_RE=/*#__PURE__*/e(/(?:\n(?:[^\n\S]|\t)+\/\*{2}\s*\n\s*\*\s+((?:[^@].+)?)[\s\S]*?)?private\s+([\w<>[\]]+)\s+(\w+);/g,{desc:1,type:2,name:3}),p.NESTED_STATIC_CLASS_RE=/*#__PURE__*/e(/public\s+static\s+class\s+(\w+).*?\{/g,{class_name:1}),p),_=(h=/*#__PURE__*/function(e){function t(t,n,r){var s;return(s=e.call(this,t,n,r)||this).enumName=void 0,s.properties=void 0,s._getEnumName(),s._getProperties(),a(s)||a(s)}n(t,e),t.match=function(e){var n=t.PROPERTY_RE;return new RegExp(t.ENUM_RE).test(e)&&new RegExp(n).test(e)};var r=t.prototype;return r._getEnumName=function(){var e=new RegExp(t.ENUM_RE).exec(this.javaCode);this.enumName=e[1]},r._getProperties=function(){for(var e,n=[],r=new RegExp(t.PROPERTY_RE);null!==(e=r.exec(this.javaCode));)n.push({desc:e[1],type:e[2],key:e[3],value:e[4]});this.properties=n},r._getJSDocWithTS=function(){if(!this.properties.length)return"";o(this.properties[0].type,this.meta.outputTS);var e=new RegExp(t.PROPERTY_RE).test(this.javaCode)?this.properties.map(function(e,t){var n=e.desc,r=e.value;return"  "+(e.key+(r?" = "+m(r,"'"):"")+", "+(n?"// "+m(n):"")).trim()}).join("\n").trim():"/*TODO no property*/";return e="export enum "+this.enumName+" {\n  "+e+"\n}\n",global.dtsCache[this.enumName]=this.javaPath,v(e)},r._getJSDoc=function(){if(!this.properties.length)return"";var e=o(this.properties[0].type),n=new RegExp(t.PROPERTY_RE).test(this.javaCode)?this.properties.map(function(e,t){var n=e.desc,r=e.value;return"  "+(e.key+(r?": "+m(r,"'"):": "+t)+", "+(n?"// "+m(n):"")).trim()}).join("\n").trim():"* @todo no property";return v(n="/**\n * @readonly\n * @enum {"+e+"}\n */\n"+(n="export const "+this.enumName+" = {\n  "+n+"\n}\n"))},r.parse=function(){var e={javaPath:this.javaPath,result:null};return e.result=this.meta.outputTS?this._getJSDocWithTS():this._getJSDoc(),e},t}(d),h.ENUM_RE=/*#__PURE__*/e(/public\s+class\s+(\w+)/g,{enum_name:1}),h.PROPERTY_RE=/(?:\s*\/\*{2}\n\s*\*\s+([^@\s]+?)\n[\s\S]+?)?public\sstatic\sfinal\s([\w<>[\]]+)\s+([\w_]+)\s*=\s*(("|[^\s;$])+);?/g,h),S=require("fs"),y=require("fs"),j=require("path");function w(e,t,n){var r=[],a=e,s=[];if(g.match(a))r.push(g);else if(null!=n&&n.isEnum)r.push(E.match(a)?E:_.match(a)?_:null);else if(R.match(a)){var i=null==R||null==R.matchNestedStaticClasses?void 0:R.matchNestedStaticClasses(a);if(null!=i&&i.length)for(var o=i.length-1;o>-1;o--){var u,c=i[o],l=c.startLine,p=c.endLine,h=c.className,m=null==R||null==R.extractSubclass||null==(u=R.extractSubclass(a,l,p))?void 0:u.replace(/static\s+class/,"class"),v=t.replace(/\.java$/,"")+(h+".java");s.push(new R(m,v,null==n?void 0:n.parserMeta).parse()),a=null==R||null==R.deleteSubclass?void 0:R.deleteSubclass(a,l,p)}r.push(R)}return(r=r.filter(Boolean)).length?[].concat(s,r.map(function(e){return new e(a,t,null==n?void 0:n.parserMeta).parse()})):null}global.dtsCache={},module.exports={parseJava:w,parseDir:function(e,t){return y.readdirSync(e).reduce(function(n,r){if(".java"!==j.extname(r))return n;var a=j.join(e,r),s=function(e){try{return S.readFileSync(e,"utf8")}catch(t){return console.error("read error:",e),null}}(a);if(!s)return n;var i=w(s,a,t);return i?[].concat(n,i):n},[]).filter(Boolean)}}});
//# sourceMappingURL=j2type.js.map

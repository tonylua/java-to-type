!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){function e(){e=function(e,t){return new a(e,void 0,t)};var t=RegExp.prototype,r=new WeakMap;function a(e,t,o){var s=new RegExp(e,t);return r.set(s,o||r.get(e)),n(s,a.prototype)}function o(e,t){var n=r.get(t);return Object.keys(n).reduce(function(t,r){var a=n[r];if("number"==typeof a)t[r]=e[a];else{for(var o=0;void 0===e[a[o]]&&o+1<a.length;)o++;t[r]=e[a[o]]}return t},Object.create(null))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&n(e,t)}(a,RegExp),a.prototype.exec=function(e){var r=t.exec.call(this,e);if(r){r.groups=o(r,this);var n=r.indices;n&&(n.groups=o(n,this))}return r},a.prototype[Symbol.replace]=function(e,n){if("string"==typeof n){var a=r.get(this);return t[Symbol.replace].call(this,e,n.replace(/\$<([^>]+)>/g,function(e,t){var r=a[t];return"$"+(Array.isArray(r)?r.join("$"):r)}))}if("function"==typeof n){var s=this;return t[Symbol.replace].call(this,e,function(){var e=arguments;return"object"!=typeof e[e.length-1]&&(e=[].slice.call(e)).push(o(e,s)),n.apply(this,e)})}return t[Symbol.replace].call(this,e,n)},e.apply(this,arguments)}function t(){return t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},t.apply(this,arguments)}function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,n(e,t)}function n(e,t){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},n(e,t)}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var o,s,i,u={boolean:"Boolean",Date:"String",char:"String","char[]":"String",byte:"String",short:"Number",int:"Number",Integer:"Number",long:"Number",float:"Number",double:"Number"},c=function e(t){var r=/(?:\w*)List<(\w+)>/g;return r.test(t)?e(new RegExp(r).exec(t)[1])+"[]":u[t.toLowerCase()]||t},p=function(e,t){return void 0===t&&(t=""),e.replace(/^"/,t).replace(/"$/,t)},l=function(e){return e.replace(/\n\s*\n/gm,"\n").trim()},v={jsDocServiceRequestInstanceName:"request",jsDocServiceTopImport:"import request from '@/utils/request'"},m=function(e,r,n){return this.javaCode=void 0,this.javaPath=void 0,this.meta=void 0,this.javaCode=e,this.javaPath=r,this.meta=t({},v,n),this},h=(o=/*#__PURE__*/function(e){function t(t,r,n){var o;return(o=e.call(this,t,r,n)||this).controller=void 0,o.services=void 0,o._getController(),o._getServices(),a(o)||a(o)}r(t,e);var n=t.prototype;return n._getController=function(){var e=new RegExp(t.CONTROLLER_RE).exec(this.javaCode);if(!e)throw new Error("invalid controller");this.controller={url:e[1],name:e[2]}},n._getServices=function(){for(var e,r=[],n=new RegExp(t.SERVICE_RE);null!==(e=n.exec(this.javaCode));){for(var a=e[6],o=[],s=new RegExp(t.PARAM_RE),i=void 0,u=(a||"").replace(/[\n\r]/g,"").replace(/\s+/g," ");null!==(i=s.exec(u));)o.push({param_annotation:i[1],param_type:i[2],param_name:i[3]});var c=/\/\*\*/.test(e[1]);r.push({params:o,desc:c?e[2]:"",method:e[3],url:e[4],res:e[5],name:e[6]})}this.services=r},n._renderServices=function(e){var t,r=this,n=(""+this.controller.url+e.url).replace(/\/+/g,"/"),a=e.params.reduce(function(e,t){var r=t.param_annotation,n="{"+t.param_name+"}";return null!=r&&r.includes("PathVariable")&&e.includes(n)&&(e=e.replace(n,"$"+n)),e},"`"+((null==(t=this.meta)?void 0:t.apiPrefix)||"")+n+"`"),o=n.replace(/\/{\w+?}/g,"").replace(/\/(\w)/g,function(e,t){return t.toUpperCase()}).replace(/^\w/,function(e){return e.toLowerCase()}),s=e.params.map(function(e){var t=e.param_type,r=e.param_name,n=e.param_annotation,a=(null==n?void 0:n.includes("RequestHeader"))?"headers."+r:r,o=n&&n.includes("@NotNull")?" "+a:" ["+a+"]";return("* @param {"+c(t)+"} "+o).trim()}).join("\n ").trim(),i=function(e){var t=e.param_name,r=e.param_annotation;return(null==r?void 0:r.includes("RequestHeader"))?null:t},u=e.params.map(i).filter(Boolean).join(", "),p=e.params.filter(function(e){var t=e.param_annotation;return!t||!t.includes("PathVariable")}).map(i).filter(Boolean).map(function(e){return r.javaCode.includes("ResponseBody")?"..."+e:e});console.log(e.name,e.method);var l=e.method.toLowerCase(),v=/(post|put|patch|delete)/.test(l)?"body":"params",m=p.length?v+": {\n      "+p.join(",\n      ")+"\n    }":"";return"/** "+e.desc+" "+o+"\n * @url "+n+"\n * @method "+l.toUpperCase()+"\n "+s+"\n * @return {Promise<"+c(e.res)+">}\n */\n\nexport function "+o+" ("+u+") {\n  return "+this.meta.jsDocServiceRequestInstanceName+"({\n    url: "+a+",\n    method: '"+l+"',\n    "+m+"\n  })\n}\n  "},n._getJSDoc=function(){var e=l(this.services.map(this._renderServices.bind(this)).join("\n").trim());return this.meta.jsDocServiceTopImport+"\n\n"+e},n.parse=function(e){void 0===e&&(e="jsdoc");var t={javaPath:this.javaPath,result:null};return"jsdoc"===e&&(t.result=this._getJSDoc()),t},t}(m),o.CONTROLLER_RE=/*#__PURE__*/e(/@RestController\s*\n\s*@RequestMapping\("([\w\/_-{}:]+?)"\)\s*\npublic\s+class\s+(\w+?)Controller\s+/g,{url:1,name:2}),o.SERVICE_RE=/*#__PURE__*/e(/(\/\*{2}\n\s+\*\s+([^@\s]*?)\n(?:[\s\S]+?))?@(?:(Get|Post|Update|Put|Delete)?)Mapping\(\s*(?:value\s*=\s*)?"([\w\/_-{}:]+?)".*?\)(?:[\s\S]+?)public\s+([\w<>_[\](,\s)]+?)\s+([\w_-]+?)\(([\s\S]+?)?\)?\s*\{/gi,{desc:2,method:3,url:4,res:5,name:6,params_str:7}),o.PARAM_RE=/*#__PURE__*/e(/(@.*?\s)?([\w<>_[\](,\s)]+?)\s+(\w+)(?:,\s*)?/g,{param_annotation:1,param_type:2,param_name:3}),o),f=(s=/*#__PURE__*/function(e){function t(t,r,n){var o;return(o=e.call(this,t,r,n)||this).enumName=void 0,o.properties=void 0,o._getEnumName(),o._getProperties(),a(o)||a(o)}r(t,e);var n=t.prototype;return n._getEnumName=function(){var e=new RegExp(t.ENUM_RE).exec(this.javaCode);this.enumName=e[1]},n._getProperties=function(){for(var e,r=[],n=new RegExp(t.PROPERTY_RE);null!==(e=n.exec(this.javaCode));){var a={key:e[1],value:e[2],desc:e[3]};a.type=/["']+/.test(a.value)?"String":"Number",r.push(a)}this.properties=r},n._getJSDoc=function(){if(!this.properties.length)return"";var e=c(this.properties[0].type),r=new RegExp(t.PROPERTY_RE).test(this.javaCode)?this.properties.map(function(e,t){var r=e.desc,n=e.value;return"  "+(e.key+(n?": "+p(n,"'"):": "+t)+", "+(r?"// "+p(r):"")).trim()}).join("\n").trim():"* @todo no property";return l(r="/**\n * @readonly\n * @enum {"+e+"}\n */\n"+(r="export const "+this.enumName+" = {\n  "+r+"\n}\n"))},n.parse=function(e){void 0===e&&(e="jsdoc");var t={javaPath:this.javaPath,result:null};return"jsdoc"===e&&(t.result=this._getJSDoc()),t},t}(m),s.ENUM_RE=/*#__PURE__*/e(/public\s+enum\s+(\w+)/g,{enum_name:1}),s.PROPERTY_RE=/*#__PURE__*/e(/([A-Z_]+?)(?:\((\S+?)\s*(?:,\s*(\S+?))?\))?[,;]/gm,{key:1,value:2,desc:3}),s),d=(i=/*#__PURE__*/function(e){function t(t,r,n){var o;return(o=e.call(this,t,r,n)||this).className=void 0,o.properties=void 0,o._getClassName(),o._getProperties(),a(o)||a(o)}r(t,e);var n=t.prototype;return n._getClassName=function(){var e=new RegExp(t.CLASS_RE).exec(this.javaCode);this.className=e[1]},n._getProperties=function(){for(var e,r=[],n=new RegExp(t.PROPERTY_RE);null!==(e=n.exec(this.javaCode));){var a={desc:e[1],type:e[2],name:e[3],isOptional:!e[0].includes("@NotNull")};r.push(a)}this.properties=r},n._getJSDoc=function(){var e=new RegExp(t.PROPERTY_RE).test(this.javaCode)?this.properties.map(function(e){var t=e.desc,r=e.name,n=e.isOptional?" ["+r+"]":" "+r,a=t?" - "+t:"";return("* @property {"+c(e.type)+"} "+n+a).trim()}).join("\n ").trim():"* @todo no property";return l(e="/**\n * @typedef {Object} "+this.className+"\n "+e+"\n*/")},n.parse=function(e){void 0===e&&(e="jsdoc");var t={javaPath:this.javaPath,result:null};return"jsdoc"===e&&(t.result=this._getJSDoc()),t},t}(m),i.CLASS_RE=/*#__PURE__*/e(/public\s+class\s+(\w+)/g,{class_name:1}),i.PROPERTY_RE=/*#__PURE__*/e(/(?:\s*\/\*{2}\s*\n\s*\*\s+((?:[^@].)+?)[\s\S]*?)?private\s+([\w<>[\]]+)\s+(\w+);/g,{desc:1,type:2,name:3}),i),g=require("fs"),_=require("fs"),R=require("path");function y(e,t,r){var n=null;return null!=r&&r.isService||/@RestController/.test(e)?n=h:null!=r&&r.isEnum||/public\s+enum\s+/.test(e)?n=f:/public\s+class\s+/.test(e)&&(n=d),n?new n(e,t,null==r?void 0:r.parserMeta).parse("jsdoc"):null}module.exports={parseJava:y,parseDir:function(e,t){return _.readdirSync(e).reduce(function(r,n){if(".java"!==R.extname(n))return r;var a=R.join(e,n),o=function(e){try{return g.readFileSync(e,"utf8")}catch(t){return console.error("read error:",e),null}}(a);return o?(r.push(y(o,a,t)),r):r},[])}}});
//# sourceMappingURL=j2type.js.map

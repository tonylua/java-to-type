!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){function e(){e=function(e,t){return new a(e,void 0,t)};var t=RegExp.prototype,r=new WeakMap;function a(e,t,i){var o=new RegExp(e,t);return r.set(o,i||r.get(e)),n(o,a.prototype)}function i(e,t){var n=r.get(t);return Object.keys(n).reduce(function(t,r){var a=n[r];if("number"==typeof a)t[r]=e[a];else{for(var i=0;void 0===e[a[i]]&&i+1<a.length;)i++;t[r]=e[a[i]]}return t},Object.create(null))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&n(e,t)}(a,RegExp),a.prototype.exec=function(e){var r=t.exec.call(this,e);if(r){r.groups=i(r,this);var n=r.indices;n&&(n.groups=i(n,this))}return r},a.prototype[Symbol.replace]=function(e,n){if("string"==typeof n){var a=r.get(this);return t[Symbol.replace].call(this,e,n.replace(/\$<([^>]+)>/g,function(e,t){var r=a[t];return"$"+(Array.isArray(r)?r.join("$"):r)}))}if("function"==typeof n){var o=this;return t[Symbol.replace].call(this,e,function(){var e=arguments;return"object"!=typeof e[e.length-1]&&(e=[].slice.call(e)).push(i(e,o)),n.apply(this,e)})}return t[Symbol.replace].call(this,e,n)},e.apply(this,arguments)}function t(){return t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},t.apply(this,arguments)}function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,n(e,t)}function n(e,t){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},n(e,t)}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var i=require("path"),o={boolean:"Boolean",Date:"String",char:"String","char[]":"String",String:"String",byte:"String",short:"Number",int:"Number",Integer:"Number",long:"Number",float:"Number",double:"Number"},s=function e(t,r){void 0===r&&(r=!1);var n=/(?:\w*)List<(\w+)>/g;if(n.test(t))return e(new RegExp(n).exec(t)[1],r)+"[]";var a=o[t.toLowerCase()];return a?r?a.toLowerCase():a:t};function u(e,t){var r=null==t?void 0:t.serviceMeta,n=s(e,null==t?void 0:t.outputTS),a=/^(.*?)(\[\])+$/.exec(n);if(a)return u(a[1],r)+a[2];var o=/^(.*?)<(.*?)>$/.exec(n);if(o){var p=o[2].split(/\s*\,\s*/).map(function(e){return u(e,r)}).join(", ");return o[1]+"<"+p+">"}if(n in global.dtsCache){var c=i.dirname(global.dtsCache[n]),l=Object.keys(r).find(function(e){return e===c});l&&(n="import('"+r[l].replace(/\.d\.ts$/,"")+"')."+n)}return n}var p,c,l,h,m=function(e,t){return void 0===t&&(t=""),e.replace(/^"/,t).replace(/"$/,t)},v=function(e){return e.replace(/\n\s*\n/gm,"\n").trim()},f={jsDocServiceRequestInstanceName:"request",jsDocServiceTopImport:"import request from '@/utils/request'"},d=function(e,r,n){return this.javaCode=void 0,this.javaPath=void 0,this.meta=void 0,this.javaCode=e,this.javaPath=r,this.meta=t({},f,n),this},g=(p=/*#__PURE__*/function(e){function t(t,r,n){var i;return(i=e.call(this,t,r,n)||this).controller=void 0,i.services=void 0,i._getController(),i._getServices(),a(i)||a(i)}r(t,e);var n=t.prototype;return n._getController=function(){var e=new RegExp(t.CONTROLLER_RE).exec(this.javaCode);if(!e)throw new Error("invalid controller");this.controller={url:e[1],name:e[2]}},n._getServices=function(){for(var e,r=[],n=new RegExp(t.SERVICE_RE);null!==(e=n.exec(this.javaCode));){for(var a=e[7],i=[],o=new RegExp(t.PARAM_RE),s=void 0,u=(a||"").replace(/[\n\r]/g,"").replace(/\s+/g," ");null!==(s=o.exec(u));)i.push({param_annotation:s[1],param_type:s[2],param_name:s[3]});var p=/\/\*\*/.test(e[1]);r.push({params:i,desc:p?e[2]:"",method:e[3],url:e[4],res:e[5],name:e[6]})}this.services=r},n._renderServices=function(e){var t,r=this,n=(""+this.controller.url+e.url).replace(/\/+/g,"/"),a=e.params.reduce(function(e,t){var r=t.param_annotation,n="{"+t.param_name+"}";return null!=r&&r.includes("PathVariable")&&e.includes(n)&&(e=e.replace(n,"$"+n)),e},"`"+((null==(t=this.meta)?void 0:t.apiPrefix)||"")+n+"`"),i=n.replace(/\/{\w+?}/g,"").replace(/\/(\w)/g,function(e,t){return t.toUpperCase()}).replace(/^\w/,function(e){return e.toLowerCase()}),o=e.params.map(function(e){var t=e.param_type,n=e.param_name,a=e.param_annotation,i=(null==a?void 0:a.includes("RequestHeader"))?"headers."+n:n,o=a&&a.includes("@NotNull")?" "+i:" ["+i+"]";return("* @param {"+u(t,r.meta)+"} "+o).trim()}).join("\n ").trim(),s=function(e){var t=e.param_name,r=e.param_annotation;return(null==r?void 0:r.includes("RequestHeader"))?null:t},p=e.params.map(s).filter(Boolean).join(", "),c=e.params.filter(function(e){var t=e.param_annotation;return!t||!t.includes("PathVariable")}).map(s).filter(Boolean).map(function(e){return r.javaCode.includes("ResponseBody")?"..."+e:e}),l=e.method.toLowerCase(),h=/(post|put|patch|delete)/.test(l)?"body":"params",m=c.length?h+": {\n      "+c.join(",\n      ")+"\n    }":"";return"/** "+e.desc+" "+i+"\n * @url "+n+"\n * @method "+l.toUpperCase()+"\n "+o+"\n * @return {Promise<"+u(e.res,this.meta)+">}\n */\n\nexport function "+i+" ("+p+") {\n  return "+this.meta.jsDocServiceRequestInstanceName+"({\n    url: "+a+",\n    method: '"+l+"',\n    "+m+"\n  })\n}\n  "},n._getJSDoc=function(){var e=v(this.services.map(this._renderServices.bind(this)).join("\n").trim());return this.meta.jsDocServiceTopImport+"\n\n"+e},n.parse=function(e){void 0===e&&(e="jsdoc");var t={javaPath:this.javaPath,result:null};return"jsdoc"===e&&(t.result=this._getJSDoc()),t},t}(d),p.CONTROLLER_RE=/*#__PURE__*/e(/@RestController\s*\n\s*@RequestMapping\("([\w\/_-{}:]+?)"\)[\s\S]*?\npublic\s+class\s+(\w+?)Controller\s+/g,{url:1,name:2}),p.SERVICE_RE=/*#__PURE__*/e(/(\/\*{2}\n\s+\*\s+([^@\s]*?)\n(?:[\s\S]+?))?@(?:(Get|Post|Update|Put|Delete)?)Mapping\(\s*(?:value\s*=\s*)?"([\w\/_-{}:]+?)".*?\)(?:[\s\S]+?)public\s+([\w<>_[\](,\s)]+?)\s+([\w_-]+?)\(([\s\S]*)\)?\s*\{/gi,{desc:2,method:3,url:4,res:5,name:6,params_str:7}),p.PARAM_RE=/*#__PURE__*/e(/(@.*?\s)?([\w<>_[\](,\s)]+?)\s+(\w+)(?:,\s*)?/g,{param_annotation:1,param_type:2,param_name:3}),p),R=(c=/*#__PURE__*/function(e){function t(t,r,n){var i;return(i=e.call(this,t,r,n)||this).enumName=void 0,i.properties=void 0,i._getEnumName(),i._getProperties(),a(i)||a(i)}r(t,e),t.toString=function(){return"EnumParser"};var n=t.prototype;return n._getEnumName=function(){var e=new RegExp(t.ENUM_RE).exec(this.javaCode);this.enumName=null==e?void 0:e[1]},n._getProperties=function(){for(var e,r=[],n=new RegExp(t.PROPERTY_RE);null!==(e=n.exec(this.javaCode));){var a={key:e[1],value:e[2],desc:e[3]};a.type=/["']+/.test(a.value)?"String":"Number",r.push(a)}this.properties=r},n._getJSDocWithTS=function(){if(!this.properties.length)return"";s(this.properties[0].type,this.meta.outputTS);var e=new RegExp(t.PROPERTY_RE).test(this.javaCode)?this.properties.map(function(e,t){var r=e.desc,n=e.value;return"  "+(e.key+(n?" = "+m(n,"'"):"")+", "+(r?"// "+m(r):"")).trim()}).join("\n").trim():"/*TODO no property*/";return e="export enum "+this.enumName+" {\n  "+e+"\n}\n",global.dtsCache[this.enumName]=this.javaPath,v(e)},n._getJSDoc=function(){if(!this.properties.length)return"";var e=s(this.properties[0].type),r=new RegExp(t.PROPERTY_RE).test(this.javaCode)?this.properties.map(function(e,t){var r=e.desc,n=e.value;return"  "+(e.key+(n?": "+m(n,"'"):": "+t)+", "+(r?"// "+m(r):"")).trim()}).join("\n").trim():"* @todo no property";return v(r="/**\n * @readonly\n * @enum {"+e+"}\n */\n"+(r="export const "+this.enumName+" = {\n  "+r+"\n}\n"))},n.parse=function(e){void 0===e&&(e="jsdoc");var t={javaPath:this.javaPath,result:null};return"jsdoc"===e&&(t.result=this.meta.outputTS?this._getJSDocWithTS():this._getJSDoc()),t},t}(d),c.ENUM_RE=/*#__PURE__*/e(/public\s+enum\s+(\w+)/g,{enum_name:1}),c.PROPERTY_RE=/*#__PURE__*/e(/([A-Z_]+?)(?:\((\S+?)\s*(?:,\s*(\S+?))?\))?[,;]/gm,{key:1,value:2,desc:3}),c),_=(l=/*#__PURE__*/function(e){function t(t,r,n){var i;return(i=e.call(this,t,r,n)||this).className=void 0,i.properties=void 0,i._getClassName(),i._getProperties(),a(i)||a(i)}r(t,e);var n=t.prototype;return n._getClassName=function(){var e=new RegExp(t.CLASS_RE).exec(this.javaCode);this.className=e[1]},n._getProperties=function(){for(var e,r=[],n=new RegExp(t.PROPERTY_RE);null!==(e=n.exec(this.javaCode));){var a={desc:e[1],type:e[2],name:e[3],isOptional:!e[0].includes("@NotNull")};r.push(a)}this.properties=r},n._getJSDoc=function(){var e=new RegExp(t.PROPERTY_RE).test(this.javaCode)?this.properties.map(function(e){var t=e.desc,r=e.name,n=e.isOptional?" ["+r+"]":" "+r,a=t?" - "+t:"";return("* @property {"+s(e.type)+"} "+n+a).trim()}).join("\n ").trim():"* @todo no property";return v(e="/**\n * @typedef {Object} "+this.className+"\n "+e+"\n*/")},n._getJSDocWithTS=function(){var e=this,r=new RegExp(t.PROPERTY_RE).test(this.javaCode)?this.properties.map(function(t){var r=t.desc;return(t.name+(t.isOptional?"?":"")+": "+s(t.type,e.meta.outputTS)+";"+(r?" // "+r:"")).trim()}).join("\n ").trim():"/*TODO no property*/";return r="export type "+this.className+" = {\n "+r+"\n}\n",global.dtsCache[this.className]=this.javaPath,v(r)},n.parse=function(e){void 0===e&&(e="jsdoc");var t={javaPath:this.javaPath,result:null};return"jsdoc"===e&&(t.result=this.meta.outputTS?this._getJSDocWithTS():this._getJSDoc()),t},t}(d),l.CLASS_RE=/*#__PURE__*/e(/public\s+class\s+(\w+)/g,{class_name:1}),l.PROPERTY_RE=/*#__PURE__*/e(/(?:\s*\/\*{2}\s*\n\s*\*\s+((?:[^@].)+?)[\s\S]*?)?private\s+([\w<>[\]]+)\s+(\w+);/g,{desc:1,type:2,name:3}),l),E=(h=/*#__PURE__*/function(e){function t(t,r,n){var i;return(i=e.call(this,t,r,n)||this).enumName=void 0,i.properties=void 0,i._getEnumName(),i._getProperties(),a(i)||a(i)}r(t,e),t.toString=function(){return"ConstantParser"};var n=t.prototype;return n._getEnumName=function(){var e=new RegExp(t.ENUM_RE).exec(this.javaCode);this.enumName=e[1]},n._getProperties=function(){for(var e,r=[],n=new RegExp(t.PROPERTY_RE);null!==(e=n.exec(this.javaCode));)r.push({desc:e[1],type:e[2],key:e[3],value:e[4]});this.properties=r},n._getJSDocWithTS=function(){if(!this.properties.length)return"";s(this.properties[0].type,this.meta.outputTS);var e=new RegExp(t.PROPERTY_RE).test(this.javaCode)?this.properties.map(function(e,t){var r=e.desc,n=e.value;return"  "+(e.key+(n?" = "+m(n,"'"):"")+", "+(r?"// "+m(r):"")).trim()}).join("\n").trim():"/*TODO no property*/";return e="export enum "+this.enumName+" {\n  "+e+"\n}\n",global.dtsCache[this.enumName]=this.javaPath,v(e)},n._getJSDoc=function(){if(!this.properties.length)return"";var e=s(this.properties[0].type),r=new RegExp(t.PROPERTY_RE).test(this.javaCode)?this.properties.map(function(e,t){var r=e.desc,n=e.value;return"  "+(e.key+(n?": "+m(n,"'"):": "+t)+", "+(r?"// "+m(r):"")).trim()}).join("\n").trim():"* @todo no property";return v(r="/**\n * @readonly\n * @enum {"+e+"}\n */\n"+(r="export const "+this.enumName+" = {\n  "+r+"\n}\n"))},n.parse=function(e){void 0===e&&(e="jsdoc");var t={javaPath:this.javaPath,result:null};return"jsdoc"===e&&(t.result=this.meta.outputTS?this._getJSDocWithTS():this._getJSDoc()),t},t}(d),h.ENUM_RE=/*#__PURE__*/e(/public\s+class\s+(\w+)/g,{enum_name:1}),h.PROPERTY_RE=/(?:\s*\/\*{2}\n\s*\*\s+([^@\s]+?)\n[\s\S]+?)?public\sstatic\sfinal\s([\w<>[\]]+)\s+([\w_]+)\s*=\s*(("|[^\s;$])+);?/g,h),y=require("fs"),j=require("fs"),S=require("path");function P(e,t,r){var n=null;return null!=r&&r.isService||/@RestController/.test(e)?n=g:null!=r&&r.isEnum?/public\s+enum\s+/.test(e)?n=R:E.PROPERTY_RE.test(e)&&(n=E):/public\s+class\s+/.test(e)&&(n=_),n?new n(e,t,null==r?void 0:r.parserMeta).parse("jsdoc"):null}global.dtsCache={},module.exports={parseJava:P,parseDir:function(e,t){return j.readdirSync(e).reduce(function(r,n){if(".java"!==S.extname(n))return r;var a=S.join(e,n),i=function(e){try{return y.readFileSync(e,"utf8")}catch(t){return console.error("read error:",e),null}}(a);return i?(r.push(P(i,a,t)),r):r},[])}}});
//# sourceMappingURL=j2type.js.map
